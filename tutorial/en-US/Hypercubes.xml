<?xml version='1.0' encoding='utf-8' ?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
<!ENTITY % BOOK_ENTITIES SYSTEM "SECTutorial.ent">
%BOOK_ENTITIES;
]>
<chapter id="chap-BizQLTutorial-Hypercubes">
  <title>Hypercube Querying</title>
  <para>In the former section, we showed how to get the fact table associated with an SEC network.
    You may have seen at several place occurrences of the word "Hypercube".
    The facts in an SEC network are actually organized in a hypercubic structure.
    We now go more into detais on this, and eventually show how you
    can build your own hypercubes and query for fact tables, outside of any SEC network.</para>


  <section>
    <title>Hypercubes</title>
    <para>Concepts, entities, periods, units, as well as further dimensions are called <emphasis
      role="bold">aspects</emphasis>. It is possible to organize facts along <emphasis role="bold"
        >hypercubes</emphasis>, the dimensions of which are these aspects. Usually, there will be
      either zero or one fact for each possible tuple of aspects. If there is more, it often
      indicates an inconsistency in the submission.</para>
    <para>For example, if we stick to the USD unit, you can imagine a cube whose width represents
      concepts (Assets, Revenues), the height of which represents entities (Amex, Disney) and
      the depth of which represents periods (year 2012, year 2013, year 2014). This hypercube
      potentially contains 2 x 2 x 3 = 12 facts.</para>
    <para>Note: From a practical perspective, it is disputed whether units are considered aspects,
      or whether they "stick" to the value.</para>
  </section>
  <section>
    <title>Building your own hypercube</title>
    <para>The simplest hypercube you can imagine is made of four "standard" aspects:
      concept, entity, period and unit. It does not restrict the
      value of any of these aspects. It is called dimensionless, because in the XBRL universe,
      the four basic aspects are not considered XBRL dimensions.</para>
    <example>
      <title>The dimensionless hypercube</title>
    <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
                                href="../../queries/public/hypercubes/dimensionless-hypercube.jq"
                                parse="text"/></programlisting>
    </example>
    <para>The result of this query shows you the object representation of a hypercube.</para>
    <example>
      <title>The object format of hypercubes</title>
      <programlisting>{
  "Name" : "xbrl:DimensionlessHypercube", 
  "Label" : "Dimensionless Hypercube", 
  "Aspects" : {
    "xbrl:Concept" : {
      "Name" : "xbrl:Concept", 
      "Label" : "Implicit XBRL Concept Dimension"
    }, 
    "xbrl:Period" : {
      "Name" : "xbrl:Period", 
      "Label" : "Implicit XBRL Period Dimension"
    }, 
    "xbrl:Entity" : {
      "Name" : "xbrl:Entity", 
      "Label" : "Implicit XBRL Entity Dimension"
    }, 
    "xbrl:Unit" : {
      "Name" : "xbrl:Unit", 
      "Label" : "Implicit XBRL Unit Dimension", 
      "Default" : "xbrl:NonNumeric"
    }
  }
}</programlisting>
    </example>
    <para>The facts in a hypercube can be queried with the function <code>sec:facts-for-hypercube</code>.
    There is a very high number of facts in this hypercube: all those without extra dimensions.
    Hundreds of thousands of them. Very often, when you query for facts against this dimensionless
    hypercube, you are asking for specifing archives. The archive is just a dimension like others, so
    you can build a user-defined hypercube with a filter on this dimension.</para>
    <para>Let's count all those facts that are in a given archive (here 1423).</para>
    <example>
      <title>Retrieving the facts in the dimensionless hypercube for some filings</title>
      <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
                                href="../../queries/public/hypercubes/dimensionless-with-archive.jq"
                                parse="text"/></programlisting>
    </example>
    <para>Instead of looking at a single archive, you can look across archives, for concepts like <code>us-gaap:Assets</code> and <code>us-gaap:Equity</code>.
      In order to do so, you need to modify the dimensionless hypercube and add a filter on these two concepts (you
      could also use a user-defined hypercube, but if all you do is filter on concepts/entities/periods/units, then
      the dimensionless hypercube is sufficient and simpler to use).
      There are over 70k such facts.</para>
    <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
                                href="../../queries/public/hypercubes/dimensionless-with-concepts.jq"
                                parse="text"/></programlisting>
    <para>You can also build your own hypercube.
      To restrict a dimension, just add
      a field (One of <code>Concepts</code>, <code>Entities</code>, <code>Periods</code>, <code>Units</code>) with an array of values.
      Below we show you how to make a restriction on DOW30 companies with just a small modification
      of the dimensionless hypercube function call.</para>
    <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
                                href="../../queries/public/hypercubes/dimensionless-with-concepts-and-entities.jq"
                                parse="text"/></programlisting>
    <para>If you begin to query across archives, and attempt to filter on periods, you will very soon notice
      that it is hard, because fiscal years differ from company to company. The good news is that fiscal years and
      periods (FY, Q1, Q2, Q3) are now hypercube dimensions. You can filter on them just like we did on archives.
      For example, here is how to get all assets and equities (no extra dimensions) for FY 2012 (6847 of them)</para>
    <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
                                href="../../queries/public/hypercubes/dimensionless-with-fiscal-year.jq"
                                parse="text"/></programlisting>
    <para>What was done for the basic four dimensions (like xbrl:Equity) applies to extra dimensions as well. There is
      a more elaborate version of <code>hypercubes:dimensionless-hypercube</code> called <code>hypercubes:user-defined-hypercube</code>
      that allows you to add any number of dimensions, as well as restrict on them or add default values.
      Here you can ask for facts reported against the <code>us-gaap:DividendsCommonStock</code> concept,
      with a dimension <code>us-gaap:StatementEquityComponentsAxis</code> restricted on a value
      of <code>us-gaap:CommonStockMember</code>. There are 513 of them.</para>
    <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
                                href="../../queries/public/hypercubes/extra-dimensions.jq"
                                parse="text"/></programlisting>
    <para>Finally, you can combine extra dimensions, restricting several dimensions, filtering on fiscal years,
      etc. Let's ask for the companies that submitted,
      for FY 2011, a fact against the <code>us-gaap:DividendsCommonStock</code> concept,
      with a dimension <code>us-gaap:StatementEquityComponentsAxis</code> that has a value
      of <code>us-gaap:CommonStockMember</code>.
      There's only one and it's Walt Disney. And it takes less than one second to ask for this.</para>
    <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
                                href="../../queries/public/hypercubes/combined-filtering.jq"
                                parse="text"/></programlisting>
    <para>The SEC modules provide many functions that just wrap these queries in nicer code,
      and there are more to come. The documentation is there for you to find them.</para>
  </section>
    <section>
    <title>The SECXBRL.info REST API for user-defined hypercubes</title>
    <para>We also provide a REST API that allows you to build your hypercubes and ask for fact tables and, say, import them into an Excel
      spreadsheet. The API is documented <ulink url="http://www.secxbrl.info/api">here</ulink></para>
    <section>
      <title>Build your hypercube with the REST API</title>
      <para>You can build your own hypercube by using dimension names as fields in the query string, along with one or several values. For example, "xbrl:Concept=us-gaap:Goodwill" will filter for concepts named us-gaap:Goodwill.</para>
      <para>For the entity dimension, for convenience, you can use the same parameters as in the companies API: cik, ticker, tag, etc -- instead of "xbrl:Entity".</para>
      <para>For the concept dimension, use the more convenient "concept" parameter name. For example: <uri>http://secxbrl.xbrl.io/api/facts.jq?concept=us-gaap:Goodwill&amp;cik=4962</uri></para>
      <para>For requiring a dimension, without restriction, use a value of "ALL". For example: <uri>http://secxbrl.xbrl.io/api/facts.jq?concept=us-gaap:DividendsCommonStock&amp;tag=DOW30&amp;us-gaap:StatementEquityComponentsAxis=ALL</uri></para>
      <para>You can specify a default dimension value using "dimensionname:default", like so: <uri>http://secxbrl.xbrl.io/api/facts.jq?concept=us-gaap:DividendsCommonStock&amp;tag=DOW30&amp;us-gaap:StatementEquityComponentsAxis=ALL&amp;us-gaap:StatementEquityComponentsAxis:default=sec:myDefault</uri></para>
      <para>The last query in the former section corresponds to <uri>http://secxbrl.xbrl.io/api/facts.jq?concept=us-gaap:DividendsCommonStock&amp;tag=DOW30&amp;us-gaap:StatementEquityComponentsAxis=us-gaap:CommonStockMember&amp;fiscalYear=2012&amp;fiscalPeriod=FY</uri></para>
    </section>
  </section>
</chapter>
