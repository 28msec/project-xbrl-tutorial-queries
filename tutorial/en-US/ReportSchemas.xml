<?xml version='1.0' encoding='utf-8' ?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
<!ENTITY % BOOK_ENTITIES SYSTEM "SECTutorial.ent">
%BOOK_ENTITIES;
]>
<chapter id="chap-BizQLTutorial-ReportSchemas">
  <title>Report schemas</title>
  <para>For convenience, there are report schemas which provide convenient querying hypercubes, and more.</para>
  <para>By default, your project contains no report schema. In this tutorial, we provide one that you can download
    under <code>http://facs.28.io/process-report-schema.jq</code>. JSONiq is powerful enough to do this for you with
    just one click (to 28.io, the Web is nothing but yet another data source...).</para>
  <example>
    <title>Download the report schema with the Fundamental Accounting Concepts.</title>
    <programlisting><xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
                                href="../../public/report-schemas/download-facs.jq"
                                parse="text"/></programlisting>
  </example>
  <para>(Yes, JSONiq can do updates and side effects, but, ssssshhhh! don't tell anybody we showed you that).</para>
  <section>
    <title>Fundamental Accounting Concepts</title>
    <para>Querying across multiple filings, even across companies, is not easy. This is because companies might not report their data in the same way.
The Fundamental Accounting Concepts report schema provides an easy way to do so.</para>
    <para>The report schema module is named <uri>http://xbrl.io/modules/bizql/report-schemas</uri></para>
    <example>
      <title>Asking for the FAC report schema</title>
      <programlisting>import module namespace report-schemas =
    "http://xbrl.io/modules/bizql/report-schemas";

report-schemas:report-schemas("FundamentalAccountingConcepts")
</programlisting>
    </example>
    <para>A report schema looks very much like a network, except that it is not bound to any filing. In particular, it also has a model structure.</para>
    <example>
      <title>Asking for the FAC report schema</title>
      <programlisting>import module namespace report-schemas = "http://xbrl.io/modules/bizql/report-schemas";
import module namespace sec-networks =
    "http://xbrl.io/modules/bizql/profiles/sec/networks";

let $schema := report-schemas:report-schemas("FundamentalAccountingConcepts")
return sec-networks:model-structures($schema)
</programlisting>
    </example>
    <para>But they have more than that. They may define their own concepts (beginning with the <code>fac:</code> prefix) and map them to real concepts with a so-called
<code>concept map</code>.</para>
    <example>
      <title>Asking for American Express's assets with the mapped fac:Assets concept</title>
      <programlisting>import module namespace hypercubes =
    "http://xbrl.io/modules/bizql/hypercubes";
import module namespace sec =
    "http://xbrl.io/modules/bizql/profiles/sec/core";
import module namespace fiscal =
    "http://xbrl.io/modules/bizql/profiles/sec/fiscal/core";

let $hypercube := hypercubes:dimensionless-hypercube()
let $filing := fiscal:filings-for-entities-and-fiscal-periods-and-years(
    4962,
    "FY",
    2012
)
return sec:facts-for-archives-and-concepts(
    $filing,
    "fac:Assets",
    {
        Hypercube: $hypercube,
        concept-maps: "FundamentalAccountingConcepts"
    }
)

</programlisting>
    </example>
    <para>For convenience, if you directly would like to retrieve all facts for a schema, you can use <code>sec:facts-for-schema</code> with the name of the
      desired schema, and the archive for which you would like the facts.</para>
    <example>
      <title>Asking for Amex' FACs</title>
      <programlisting>import module namespace sec =
    "http://xbrl.io/modules/bizql/profiles/sec/core";
import module namespace fiscal =
    "http://xbrl.io/modules/bizql/profiles/sec/fiscal/core";

let $filing :=
    fiscal:filings-for-entities-and-fiscal-periods-and-years(
      4962,
      "FY",
      2012 )
return sec:facts-for-schema(
    "FundamentalAccountingConcepts",
    $filing
)
</programlisting>
    </example>
    <para>You can also ask for them across several archives.</para>
    <example>
      <title>Asking for the FACs of Amex and Disney</title>
      <programlisting>import module namespace sec =
    "http://xbrl.io/modules/bizql/profiles/sec/core";
import module namespace fiscal =
    "http://xbrl.io/modules/bizql/profiles/sec/fiscal/core";

let $filing :=
    fiscal:filings-for-entities-and-fiscal-periods-and-years(
      (4962, 1001039),
      "FY",
      2012 )
return sec:facts-for-schema(
    "FundamentalAccountingConcepts",
    $filing
)
</programlisting>
    </example>
  </section>
  <section>
    <title>The SECXBRL.info REST API for concept maps</title>
    <para>We also provide a REST API that allows you to look up mapped concepts and, say, import them into an Excel
      spreadsheet. The API is documented <ulink url="http://www.secxbrl.info/api">here</ulink></para>
    <section>
      <title>Retrieve a fact with a concept map</title>
      <para>You can use a concept map with the facts API using the <code>map</code> parameter, together with the name of the containing report schema, like so:
      </para>
      <para><uri>http://secxbrl.xbrl.io/api/facts.jq?concept=fac:Assets</uri>
        <uri>&amp;tag=DOW30&amp;map=FundamentalAccountingConcepts</uri></para>
    </section>
  </section>
</chapter>
